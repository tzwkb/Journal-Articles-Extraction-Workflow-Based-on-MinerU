# MinerU文档翻译工具 - 配置文件

# 调试模式
debug:
  enabled: true  # 是否启用调试模式（打印详细的 API 请求信息）

# API配置
api:
  # MinerU API Token（必填）
  # 访问 https://mineru.net 获取
  mineru_token: "eyJ0eXBlIjoiSldUIiwiYWxnIjoiSFM1MTIifQ.eyJqdGkiOiIxOTMwMDU4NyIsInJvbCI6IlJPTEVfUkVHSVNURVIiLCJpc3MiOiJPcGVuWExhYiIsImlhdCI6MTc2NTE4Mjg1MywiY2xpZW50SWQiOiJsa3pkeDU3bnZ5MjJqa3BxOXgydyIsInBob25lIjoiIiwib3BlbklkIjpudWxsLCJ1dWlkIjoiZGM3MDAzYTQtOTgzMi00NjVhLWEzOGYtM2NiNmE4MjU5ZjgxIiwiZW1haWwiOiIiLCJleHAiOjE3NjYzOTI0NTN9.wem08J7xwJ5fU7TWAIl2viQBB9z8OQPx57VrdCCgDTJWUZdb6EF5vkrJeHJJByaT8ckk_pAh7wZNY-Jy2Hnp9A"

  # 大纲生成 API 配置
  outline_api_key: "sk-WpSmtNVHpoZpS3AVL38U9ahXugHMIshzEbpMLCO7yXKigeMS"
  outline_api_base_url: "https://liangjiewis.com/v1"
  outline_api_model: "gemini-2.5-flash-lite"

  # 翻译 API 配置
  translation_api_key: "sk-WpSmtNVHpoZpS3AVL38U9ahXugHMIshzEbpMLCO7yXKigeMS"
  translation_api_base_url: "https://liangjiewis.com/v1"
  translation_api_model: "gemini-2.5-flash-lite"

  # 翻译质量问题时的备用模型（更好的模型，仅在质量检查失败时临时切换）
  fallback_translation_model: "gemini-2.5-flash"

  # API调用参数
  temperature: 0.3
  max_tokens: 4096           # 翻译API使用
  outline_max_tokens: 16384  # 大纲生成API使用（需要更大的tokens）
  timeout: 600

# 重试策略配置
retry:
  # MinerU API重试配置
  mineru_max_retries: 30              # MinerU上传/下载的最大重试次数

  # 翻译API重试配置
  translation_max_retries: 30         # 翻译API的最大重试次数
  translation_initial_delay: 1.0     # 初始延迟（秒）
  translation_max_delay: 30.0        # 最大延迟（秒）
  translation_exponential_base: 2.0  # 指数退避基数

  # 大纲生成API重试配置
  outline_max_retries: 30             # 大纲生成API的最大重试次数
  outline_initial_delay: 3.0         # 初始延迟（秒）
  outline_max_delay: 30.0            # 最大延迟（秒）
  outline_exponential_base: 2.0      # 指数退避基数

  # 重试条件开关（适用于翻译和大纲API）
  retry_on_dns_error: true           # DNS解析错误时重试
  retry_on_connection_error: true    # 连接错误时重试
  retry_on_timeout: true             # 超时错误时重试
  retry_on_5xx: true                 # 5xx服务器错误时重试
  retry_on_429: true                 # 429限流错误时重试（大纲API）
  retry_on_429_translation: true     # 429限流错误时重试（翻译API - rate_limiter降低并发后重试）

# 并发控制配置
concurrency:
  # 多文件并发数（同时处理多少个PDF文件）
  max_files: 20

  # 翻译并发控制（自适应速率限制）
  initial_translation_workers: 50      # 初始翻译并发数
  max_translation_workers: 50         # 最大翻译并发数
  min_translation_workers: 1         # 最小翻译并发数（遇到429错误时的保底值）
  rate_limit_backoff: 0.5            # 遇到429错误时的缩减系数
  rate_limit_increase: 2          # 成功时的增长系数
  success_threshold: 0.9             # 成功率阈值
  increase_interval: 30          # 持续成功多少秒后尝试增加并发

# 路径配置
paths:
  # 输入基础目录
  input_base: "input/"

  # 输出基础目录
  output_base: "output/"

  # 术语库文件夹
  terminology_folder: "terminology/"

# 输出格式配置
output:
  # 生成的输出格式列表
  # 可选: html, pdf, docx
  formats:
    - html
    - pdf
    - docx

  # 输出分类文件夹名称（大写）
  mineru_folder: "MinerU"       # MinerU解析结果
  html_folder: "HTML"           # HTML输出
  pdf_folder: "PDF"             # PDF输出
  docx_folder: "DOCX"           # DOCX输出
  cache_folder: "cache"         # 缓存文件夹

# PDF处理配置
pdf_processing:
  # 大纲生成时的PDF大小限制（base64编码后）
  max_pdf_size_mb: 20           # Base64编码后超过此大小(MB)时，自动截断PDF

  # 说明：
  # - 检查的是 base64 编码后的请求体大小，不是原始 PDF 文件大小
  # - Base64 编码会使数据增大约 33%（17MB的PDF会变成约23MB的base64）
  # - 如果 base64 > 20MB，程序会自动计算需要提取多少页才能符合限制
  # - 使用智能算法自适应截断，最大化保留页数
  # - 前N页通常包含目录，足以生成完整大纲
  # - 如果遇到 413 错误，可以降低此值（例如 15MB）


